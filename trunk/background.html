<html>
<head>
<script>
function updateUI(state, connection_name) {
  var icon_path = "proxy_off.png";
  var proxy_state = "Proxy is off";
  if (state) {
    icon_path = "proxy_on.png";
    proxy_state = "Proxy is on";
  }
  var title = connection_name + " : " + proxy_state;
  chrome.browserAction.setIcon({path: icon_path});
  chrome.browserAction.setTitle({title: title});
}

chrome.browserAction.onClicked.addListener(function(tab) {
  var plugin = document.getElementById("pluginobj");
  updateUI(plugin.toggleProxyState(), plugin.connectionName);
}); 
chrome.tabs.onCreated.addListener(function(tab) {
  var plugin = document.getElementById("pluginobj");
  updateUI(plugin.getProxyState(), plugin.connectionName);
});
chrome.tabs.onUpdated.addListener(function(tabId, changeInfo, tab) {
  var plugin = document.getElementById("pluginobj");
  updateUI(plugin.getProxyState(), plugin.connectionName);
});

</script>
</head>
<body>
<object id="pluginobj" type="application/x-switch-wininet-proxy" hidden="true">
Failed to load np plugin. You might be using the old version of the extension.</object>
</body>
</html>
