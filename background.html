<html>
<head>
<script>
  chrome.browserAction.onClicked.addListener(function(tab) {    
	  var state = document.getElementById("pluginobj").toggleProxyState(); 		
	  updateUI(state);
  });

	chrome.tabs.onUpdated.addListener(function(tabId, changeInfo, tab) {
	  var state = document.getElementById("pluginobj").getProxyState(); 		
	  updateUI(state);
  });

  function updateUI(state) {
		var icon_path = "proxy_off.png";
    if (state) {
		  icon_path = "proxy_on.png";
		}
		chrome.browserAction.setIcon({path: icon_path});
  }
</script>
</head>
<body>
<object id="pluginobj" type="application/x-switch-wininet-proxy" hidden="true">
Failed to load np plugin. You might be using the old version of the extension.</object>
</body>
</html>
