<html>
<head>
<script>
function updateUI(state) {
  var icon_path = "proxy_off.png";
  var proxy_state = "Proxy is off";
  if (state) {
    icon_path = "proxy_on.png";
    proxy_state = "Proxy is on";
  }
  chrome.browserAction.setIcon({path: icon_path});
  chrome.browserAction.setTitle({title: proxy_state});
}

chrome.browserAction.onClicked.addListener(function(tab) {
  updateUI(document.getElementById("pluginobj").toggleProxyState());
}); 
chrome.tabs.onCreated.addListener(function(tab) {
  updateUI(document.getElementById("pluginobj").getProxyState());
});
chrome.tabs.onUpdated.addListener(function(tabId, changeInfo, tab) {
  updateUI(document.getElementById("pluginobj").getProxyState());
});

</script>
</head>
<body>
<object id="pluginobj" type="application/x-switch-wininet-proxy" hidden="true">
Failed to load np plugin. You might be using the old version of the extension.</object>
</body>
</html>
